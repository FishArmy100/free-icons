<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Free Icons</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM"
      crossorigin="anonymous"
    />
    <script src="https://cdn.jsdelivr.net/gh/nextapps-de/flexsearch@0.7.31/dist/flexsearch.bundle.js"></script>
  </head>

  <body>
    <nav id="header" class="navbar p-3">
      <div class="container-fluid">
        <span class="navbar-brand mb-0 h1 text-white">Free Icons</span>
        <div>
          <input
            class="rounded-5 px-3 border-0"
            type="search"
            name="seach-input"
            id="search-input"
            placeholder="Search icons"
          />
        </div>
      </div>
    </nav>
    <div id="icons"></div>

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      #search-input {
        margin-right: 1rem;
        height: 2.5rem;
      }

      #header {
        background-color: #6366f1;
        height: 4.5rem;
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        z-index: 99999;
      }

      .icon {
        background-color: rgb(255, 255, 255);
        padding-inline: 3rem;
        padding-top: 1.5rem;
        padding-bottom: 1.5rem;
        border-radius: 10px;
        text-align: center;
        transition: background 100ms ease-in-out;
        position: relative;
        max-width: 16rem;
        display: grid;
        place-items: center;
      }

      .icon svg {
        width: 100%;
      }

      .icon p {
        text-align: center;
      }

      .icon .download {
        position: absolute;
        top: 10px;
        right: 10px;
        width: 20px;
        height: 20px;
        color: #2d2d2d;
        opacity: 0;
        transition: opacity 100ms ease-in-out;
        cursor: pointer;
      }

      .icon:hover {
        background-color: #6366f1;
      }

      .icon:hover .download {
        opacity: 1;
        color: #f5f5f5;
      }

      body {
        background-color: #f0f1f3;
      }

      #icons {
        display: grid;
        grid-template-columns: repeat(6, 1fr);
        width: min-content;
        margin-inline: auto;
        gap: 0.9rem;
        padding: 1rem;
        padding-top: 5.5rem;
      }

      @media only screen and (max-width: 1360px) {
        #icons {
          display: grid;
          grid-template-columns: repeat(5, 1fr);
          gap: 0.9rem;
          padding: 1rem;
        }
      }

      @media only screen and (max-width: 1180px) {
        #icons {
          display: grid;
          grid-template-columns: repeat(4, 1fr);
          gap: 0.9rem;
          padding: 1rem;
        }
      }

      @media only screen and (max-width: 960px) {
        #icons {
          display: grid;
          grid-template-columns: repeat(3, 1fr);
          gap: 0.9rem;
          padding: 1rem;
        }

        .icon:hover {
          background-color: #fff;
        }

        .icon .download {
          opacity: 1;
        }

        .icon:hover .download {
          color: #2d2d2d;
        }
      }

      @media only screen and (max-width: 720px) {
        #icons {
          display: grid;
          grid-template-columns: repeat(2, 1fr);
          gap: 0.9rem;
          padding: 1rem;
        }
      }
    </style>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
      crossorigin="anonymous"
    ></script>
    <script>
      const index = new window.FlexSearch.Index({
        preset: "score",
        tokenize: "full",
      });

      /**
       *
       * @returns {number}
       */
      const getNoOfIconsInOneRow = () => {
        if (innerWidth < 720) return 2;
        if (innerWidth < 960) return 3;
        if (innerWidth < 1180) return 4;
        if (innerWidth < 1360) return 5;
        return 6;
      };

      /**
       *
       * @returns {number}
       */
      function getScrollTop() {
        return window.pageYOffset !== undefined
          ? window.pageYOffset
          : (
              document.documentElement ||
              document.body.parentNode ||
              document.body
            ).scrollTop;
      }

      /**
       *
       * @param {string} name name of the file
       * @param {string} source source of the file
       */
      function download(name, source) {
        const blob = new Blob([source], { type: "text/plain" });
        const url = URL.createObjectURL(blob);

        const anchor = document.createElement("a");
        anchor.type = "text/plain";
        anchor.download = name;
        anchor.href = url;
        anchor.click();
        URL.revokeObjectURL(url);
      }

      /**
       *
       * @returns {number}
       */
      function getDocumentHeight() {
        const body = document.body;
        const html = document.documentElement;

        return Math.max(
          body.scrollHeight,
          body.offsetHeight,
          html.clientHeight,
          html.scrollHeight,
          html.offsetHeight
        );
      }

      /**
       * 
       * @returns {string}
       */
      const getDownloadIcon = (i) =>
        `<svg onclick="downloadIcon(${i})" class="download" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 512 512"><path d="M288 32c0-17.7-14.3-32-32-32s-32 14.3-32 32V274.7l-73.4-73.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l128 128c12.5 12.5 32.8 12.5 45.3 0l128-128c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L288 274.7V32zM64 352c-35.3 0-64 28.7-64 64v32c0 35.3 28.7 64 64 64H448c35.3 0 64-28.7 64-64V416c0-35.3-28.7-64-64-64H346.5l-45.3 45.3c-25 25-65.5 25-90.5 0L165.5 352H64zm368 56a24 24 0 1 1 0 48 24 24 0 1 1 0-48z"/></svg>`;

      /** @type {HTMLDivElement} */
      const iconsEl = document.getElementById("icons");

      fetch("./data.json")
        .then((r) => r.json())
        .then((allIcons) => {
          for (let i = 0; i < allIcons.length; i++) {
            const icon = allIcons[i];
            index.add(i, icon.name + "-" + icon.type);
          }

          let icons = allIcons;
          let currentIndex = 0;

          const reset_icons = () => {
            currentIndex =
              getNoOfIconsInOneRow() * Math.ceil(innerHeight / 100);
            iconsEl.innerHTML = icons
              .slice(0, currentIndex)
              .map(
                (el, i) =>
                  `<div class="icon">${getDownloadIcon(
                    i
                  )}<svg xmlns="http://www.w3.org/2000/svg" height="2em" viewBox="${
                    el.viewBox
                  }"><path d="${el.d}"/></svg><p class="mt-3">${el.name}-${
                    el.type
                  }</p></div>`
              )
              .join("");
          };
          const createIcon = (i) => {
            const data = icons[i];
            const root = document.createElement("div");
            root.className = "icon";
            root.innerHTML = `${getDownloadIcon(
              i
            )}<svg xmlns="http://www.w3.org/2000/svg" height="2em" viewBox="${
              data.viewBox
            }"><path d="${data.d}"/></svg><p class="mt-3">${data.name}-${
              data.type
            }</p>`;
            return root;
          };
          reset_icons();
          /** @type {HTMLInputElement} */
          const searchInput = document.getElementById("search-input");
          searchInput.oninput = () => {
            icons =
              searchInput.value == ""
                ? allIcons
                : index.search(searchInput.value).map((el) => allIcons[el]);
            currentIndex = 0;
            reset_icons();
          };
          window.onscroll = () => {
            if (getScrollTop() < getDocumentHeight() - window.innerHeight)
              return;
            for (
              let i = 0;
              i < getNoOfIconsInOneRow() && i < icons.length;
              i++
            ) {
              iconsEl.appendChild(createIcon(currentIndex));
              currentIndex++;
            }
          };

          window.downloadIcon = (i) => {
            const icon = icons[i];
            download(
              icon.name + "-" + icon.type + ".icon",
              `<svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="${icon.viewBox}">
  <path
    d="${icon.d}"
  />
</svg>`
            );
          };
        });
    </script>
  </body>
</html>
